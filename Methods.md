#Classifing Mendelian Medical Literature With Azure Machine Learning Studio#

##Prerequisites##
* [Download Mendelian Pubmed Dataset] (https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/datasets/Project%20Bethesda%20DataSet%20Normalized.csv)
* [Download Stop Words CSV] (https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/datasets/Stopwords.csv)
* [Create a Free Microsoft Azure Subscription](https://azure.microsoft.com/en-us/free/)

##Contents##
1. **Setup Workspace**
2. **Getting Data into an Experiment**
2. **Feature Selection**
3. **Train Model**
4. **Benchmark**
5. **Put Into Production**

##1. Setup Workspace##
**Step 1: Navigate to ML tab in Azure Portal and Click New**

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/Create%20New%20Workspace.jpg" width="70%" />

**Step 2: Create an ML Workspace**
* Choose a unique Workspace name
* Associate a pre-existing storage account or follow the steps to create your own.
* Select the South Central U.S. Datacenter
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/Create%20New%20Workspace1.jpg" width="70%"/>

**Step 3: Sign into ML Studio**

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/signInToMLStudio.jpg" width="60%"/>

##2. Getting Data into an Experiment##

**Step 1: Navigate to the Datasets tab in ML Studio and Click New**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/Datasetsnew.jpg"/>

**Step 2: Select from local file**

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/newDataset1.jpg"/>

**Step 3: Upload Datasets**

* Click 'Choose File' and select the BethesdaDataset.csv that was generated by the Movie Data Generator Project
* Name the Dataset BethesdaDataset
* Select Generic CSV File with a header
* Click the Checkmark
* Upload stopwords.csv using the same process

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/newDataset2.jpg" height="300px"/>

**Step 4: Navigate to the Experiments tab in ML Studio and Click New**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/newExpierment.jpg"/>

**Step 5: Create a New Blank Experiment**

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/newExpierment1.jpg"/>

**Step 6: Name the Experiment**
 * Rename the experiment to Bethesda
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/nameExpierment1.jpg"/>

**Step 7: Drag the dataset into the expierment**
 * Expand Saved Datasets -> My Datasets and Drag our data on to the page
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/dragDataSet.jpg"/>

**Step 8: Visualize your dataset**
 * Right Click the Bottom of Dataset and Select Visualize
 * Visualizing a dataset allows you to see useful analytics and gauge relationships between features.
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/visualize.jpg"/>


##3. Feature Selection ##

**Step 1: Grab Data Using SQL transformation**
 * Drag the SQL sql transformation module into the expierment
 * Enter the following query into the module
   ```sql
  select 
  PMID,
  Title ||  ' ' ||  Abstract
   as TextInput,
   [Research Phase Id]  as TwoClassLabel
   from t1;
```
 * Connect the module as follows 
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/sql%20transformation.jpg"/>

**Step 2: Normalization**
 * Drag Stopwords dataset into the expierment
 * Drag the python script module into the expierment
 * Put the following python code normalization snipped into the expierment
```python
# The script MUST contain a function named azureml_main
# which is the entry point for this module.
#
# The entry point function can contain up to two input arguments:
#   Param<dataframe1>: a pandas.DataFrame
#   Param<dataframe2>: a pandas.DataFrame
def azureml_main(dataframe1 = None, dataframe2 = None):
    import re
   
# Create normalized abstract entry 
    dataframe1["Normalized"]= dataframe1["TextInput"]
   
    numWords=[ "zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen","twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety","hundred", "thousand", "million", "billion", "trillion"] 
  
    for i in range( len(dataframe1["TextInput"])):
       Abstract = dataframe1["TextInput"][i]
       if(Abstract!= None):
        #to lower
        abstract = Abstract.lower()
        #remove punctuation
        abstract =re.findall(r'\w+', abstract,flags = re.UNICODE | re.LOCALE) 
        #remove stand alone numbers
        
        abstract = " ".join([x for x in abstract if not x.isdigit()])
        #remove stand alone numbers and number words    
        abstract=" ".join(filter(lambda w: not w in numWords ,abstract.split(" ")))    

        #remove stop words
        NormAbs= " ".join(filter(lambda w: not w in set(dataframe2["StopWords"]),abstract.split(" ")))
        
       else:
         NormAbs=''
         abstract=''
       dataframe1["Normalized"][i]= str(NormAbs)
      
    # Return value must be of a sequence of pandas.DataFrame
    return dataframe1,
    
```
* Link the modules as follows and run the expierment 
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/stop%20words%20and%20python.jpg"/>

**Step 3: Make TwoClass a feature**

 * Expand the Data Transformation and Manipulation tabs and drag a 'Metadata Editor' Module into the experiment.
 * Link the 'Metadata Editor' Module to the python script Module
 * Click the select modules button
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/label%20part%201.jpg"/>
 * Select the TwoClassLabel feature and add it to the list
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/label%20part%202.jpg"/>
 * Click the check mark
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/label%20part%203.jpg"/>
 * Change the fields property to "Label" this means that the feature is a category.
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/label%20part%204.jpg"/>
 
**Step 4: Make PMID a clear feature**

* Expand the Data Transformation and Manipulation tabs and drag a *second* 'Metadata Editor' Module into the experiment. This will allow you to classify by article abstract and title while using the PMID as an identifier
* Link the new 'Metadata Editor' Module to the previous Metadata Editor Module
* Click the select modules button
* Select the pmid feature and add it to the list
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/pmid1.jpg"/>

* Change the fields property to "Clear Feature" 
* Clear features are passed through the ML pipeline but are not processed by any of the other modules in the expierment
* Since there is little to no coorelation between pmid number and research type this allows us to identify our nodes without while reducing the noise in our model
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/pmid2.jpg"/>

**Step 5: Hash Features and run expierment**

Up to this point we have been dealing with strings as features. Strings are more resource intensive than to numbers to process. The best way to address this is by bagging the words our normalized strings and then hashing them into numerical features. While the new features have a 1-1 corespondence hashing is a one way function the trade off for the perfomance we gain from numerical features is that we will not know which "word bags" or statistical couplings of words are which. However we do know that the features will acurately represent out data.
* Expand the Text Analytics tab and drag the 'Feature Hashing' Module into the expierment
* Connect the 'Feature Hashing' Module to the previous 'Metadata editore'
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/featurehashing.jpg"/>
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/featurehashing2.jpg"/>
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/featurehashing3.jpg"/>

**Step 6: Project Features**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/featureselectionprojection.jpg"/>
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/featureselectionprojection2.jpg"/>
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/featureselectionprojection3.jpg"/>

##4. Train Model##
**Step 1: Train/Test Split**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/testtrainsplit.jpg"/>

**Step 2: Drag in One Vs All Classifier**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/onevsall.jpg"/>

**Step 3: Configure Two Class Decision Tree**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/decison%20tree.jpg"/>

**Step 4: Train Model**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/train1.jpg"/>

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/train2.jpg"/>

**Step 5: Score and Evaluate Model**
* drag score module into expierment
* link trained model and test set to to the score module 
* drag the evaluate module to the expierment and link the score module
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/score%20evaluate.jpg"/>
* run the expierment and visualize the evaluate module
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/ProjectBethesdaML%20Results.png)

##5. Put Into Production##
**Step 1: Set up Predictive Webservice**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/set%20up%20predictive%20webservice.jpg"/>

**Step 2: Project service inputs**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/project%20service%20inputs.jpg"/>

**Step 3: Project service outputs and run predictive expirement**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/project%20service%20outputs.jpg"/>

**Step 4: Deploy Webservice**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/deploy%20as%20web%20service.jpg"/>

**Step 5: Test webservice**
<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/test1.jpg"/>

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/test2.jpg"/>

**Step 6: Get code for webservice**

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/samplecode.jpg"/>

<img src="https://github.com/ProjectBethesda/ProjectBethesda-ResearchClassificationModel/blob/master/media/samplecode1.jpg"/>

